(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"7Bd3":function(e,a,t){"use strict";t.d(a,"a",function(){return u});var r=t("ga4K"),i=t("pxmK"),o=t("T9b0"),l=t("Ex5H"),n=t("b67C"),s=t("q4vc"),p=t("CcnG"),y=t("t/Na"),u=function(){function e(e,a,t,i){this.http=e,this.errorHandler=a,this.visibilityUtils=t,this.utilsService=i,this.url=r.a.urlMapping.PROJ_API}return e.prototype.post=function(e,a){return this.http.post(this.url+e,a)},e.prototype.get=function(e,a){return this.http.get(this.url+e+a)},e.prototype.getColumnValue=function(e,a,t){void 0===t&&(t=[]);for(var r=null,i=!0,o=a,l=0,n=t;l<n.length;l++){var s=n[l];if(null==o[s]||null==o[s]){i=!1;break}o=o[s]}return i&&null!=o[e]&&null!=o[e]&&(r=o[e]),r},e.prototype.setColumnValue=function(e,a,t,r){void 0===r&&(r=[]);for(var i=t,o=0;o<r.length;o++)null==i[r[o]]&&(i[r[o]]={}),i=i[r[o]];return i[a.toLowerCase()]="number"==typeof e?this.visibilityUtils.getDecimalNumber(e,1):e,t},e.prototype.preProcessKPIData=function(e,a){var t,r={tc:["md"],cnt:["md"]},i=e[0];for(var o in t=this.getAbsoluteDecimal(e),a.unit=t.val,a){var l;null!=(l=r[o]?"tc"==o?this.getColumnValue(o,i,r[o])*t.key:this.getColumnValue(o,i,r[o]):"tc"==o?this.getColumnValue(o,i)*t.key:this.getColumnValue(o,i))&&(a[o]=this.visibilityUtils.getDecimalFixed(l))}return a},e.prototype.preprocessTableData=function(e){var a,t=["nm","uid","cnt","tc","st","wa","fp","100%","75%","50%","25%","0%"],r={headers:["No. of Tanks with Storage"]},i={hierarchy:["md"]},o={cnt:i,tc:i,"100%":r,"75%":r,"50%":r,"25%":r,"0%":r},l=[],n={};a=this.getAbsoluteDecimal(e);for(var s=0,p=e;s<p.length;s++){var y=p[s];n={};for(var u=0,c=t;u<c.length;u++){var m=c[u],h=void 0;null==(h=o[m]&&o[m].hierarchy?"tc"==m||"st"==m?this.getColumnValue(m,y,o[m].hierarchy)*a.key:this.getColumnValue(m,y,o[m].hierarchy):"tc"==m||"st"==m?this.getColumnValue(m,y)*a.key:this.getColumnValue(m,y))&&(h="-"),n=o[m]&&o[m].headers?this.setColumnValue(h,m,n,o[m].headers):this.setColumnValue(h,m,n)}this.utilsService.isEmptyObj(n)||l.push(n)}return l},e.prototype.preProcessLastLeveltableData=function(e){var a=["nm","uid","tc","st","fp","lg","lt","sma"],t={hierarchy:["md"]},r={tc:t,lg:t,lt:t,sma:t},i=[],o={};this.getAbsoluteDecimal(e);for(var l=0,n=e;l<n.length;l++){var s=n[l];o={};for(var p=0,y=a;p<y.length;p++){var u=y[p],c=void 0;null==(c=r[u]&&r[u].hierarchy?this.getColumnValue(u,s,r[u].hierarchy):this.getColumnValue(u,s))&&(c="-"),"lt"!=u&&"lg"!=u?o=r[u]&&r[u].headers?this.setColumnValue(c,u,o,r[u].headers):this.setColumnValue(c,u,o):o[u]=c}this.utilsService.isEmptyObj(o)||i.push(o)}return i},e.prototype.getStorageUnitBasedOnCapacity=function(e,a){return"MCFT"==a.val&&(e*=1),"TMC"==a.val&&(e*=.001),e},e.prototype.getAbsoluteDecimal=function(e){for(var a=0,t=0,r=0,i=e;r<i.length;r++){var o=i[r];o.hasOwnProperty("md")&&"TOTAL"!=o.nm&&null!=o.md.tc&&(a+=1,t=o.md.tc+t)}var l={key:null,val:null},n=(t/a).toString().split(".")[0].length;return 3!=n&&2!=n||(l.key=1,l.val="MCFT"),n>3&&(l.key=.001,l.val="MCFT"),n<2&&(l.key=1e3,l.val="MCFT"),l},e.prototype.getViewList=function(e){return e!=o.a.LOCATIONS.GODAVARI.NAME?[o.a.VIEWS.ADMIN]:[o.a.VIEWS.BASIN]},e.prototype.getLocationList=function(){return[o.a.LOCATIONS.TAMILNADU]},e.prototype.getHeatMapList=function(){return[{key:"ACTUAL",value:"Actual"},{key:"DEVIATION",value:"Deviation"}]},e.prototype.getColumnConfig=function(e){var a=this.getColumnsDisplayNames();return"TELANGANA_MITANK"==e.src?{show:["nm","cnt","tc","st","fp","100%","75%","50%","25%","0%"],properties:{nm:{hideable:!1,type:"LOCATION$LOCATION_DISABLED",displayAs:"Location",stopAt:"",append:"uid"},cnt:{hideable:!0,displayAs:a.cnt,type:"NUMBER"},tc:{hideable:!0,displayAs:"-",type:"NUMBER"},st:{hideable:!0,displayAs:a.st,type:"NUMBER"},fp:{hideable:!0,displayAs:a.fp,type:"NUMBER"},"100%":{hideable:!0,displayAs:a["100%"],type:"NUMBER"},"75%":{hideable:!0,displayAs:a["75%"],type:"NUMBER"},"50%":{hideable:!0,displayAs:a["50%"],type:"NUMBER"},"25%":{hideable:!0,displayAs:a["25%"],type:"NUMBER"},"0%":{hideable:!0,displayAs:a["0%"],type:"NUMBER"},wa:{hideable:!0,displayAs:a.wa,type:"NUMBER"}}}:{show:["nm","cnt","tc","st","fp","100%","75%","50%","25%","0%","wa"],properties:{nm:{hideable:!1,type:"LOCATION$LOCATION_DISABLED",displayAs:"Location",stopAt:"",append:"uid"},cnt:{hideable:!0,displayAs:a.cnt,type:"NUMBER"},tc:{hideable:!0,displayAs:"-",type:"NUMBER"},st:{hideable:!0,displayAs:"-",type:"NUMBER"},fp:{hideable:!0,displayAs:a.fp,type:"NUMBER"},"100%":{hideable:!0,displayAs:a["100%"],type:"NUMBER"},"75%":{hideable:!0,displayAs:a["75%"],type:"NUMBER"},"50%":{hideable:!0,displayAs:a["50%"],type:"NUMBER"},"25%":{hideable:!0,displayAs:a["25%"],type:"NUMBER"},"0%":{hideable:!0,displayAs:a["0%"],type:"NUMBER"},wa:{hideable:!0,displayAs:a.wa,type:"NUMBER"}}}},e.prototype.getColumnsDisplayNames=function(){return{cnt:"Number of Tanks",fp:"Fill %",st:"Storage (MCFT)",wa:"Water Spread Area (km\xb2)","0%":"0 (%)","25%":"0 -25 (%)","50%":"25-50 (%)","75%":"50-75 (%)","100%":"75-100 (%)"}},e.prototype.getColNamesFromDisplayNames=function(){return{"Number of Tanks":"cnt","Fill %":"fp","Storage (MCFT)":"st","Capacity (MCFT)":"tc","Water Spread Area (km\xb2)":"wa","0 (%)":"0%","0 -25 (%)":"25%","25-50 (%)":"50%","50-75 (%)":"75%","75-100 (%)":"100%"}},e.prototype.getTableConfig=function(){return{tableInfo:{title:{display:!1}},css:{tableClass:"table table-bordered align-items-center",theadClass:" text-center"},sortOptions:{sortIndex:0,sortType:"asc",flag:!0},downloadButton:{display:!0,text:"",align:"right",order:"order-md-2"},downloadOptions:[{downloadType:"xls",downloadFileName:"MI Tanks",downloadAll:!0,metaData:!1},{downloadType:"pdf",downloadFileName:"MI Tanks",downloadAll:!0,metaData:!1}],searchFilter:{display:!0,align:"left",order:"order-md-1"},totalRow:{position:"bottom",displayAs:"Summary",name:"TOTAL",jsonKey:"nm",colspan:2},paginatorOptions:{limit:50,maxSize:5,visible:!0,dropdownOptions:[{value:25,display:"25"},{value:50,display:"50"},{value:75,display:"75"},{value:100,display:"100"},{value:125,display:"125"},{value:-1,display:"All"}]},tableHeaderFixerInfo:{headerFix:!0,colFix:!0,rowFix:!1,noOfCol:2,noOfRow:0}}},e.prototype.getPostDataForTableForMap=function(e){var a={eDate:e.eDate,sDate:e.sDate,pUUID:e.pEUUID,pType:l.m.LOCATIONS.STATE,format:e.timeStep,cType:l.m.LOCATIONS.DISTRICT,pEUUID:e.pEUUID,src:e.src,aggr:"LATEST",viewPEUUID:e.pEUUID,view:e.view};return e.location.NAME==o.a.LOCATION_LEVEL.TAMILNADU&&e.view==o.a.VIEWS.BASIN?a.viewPEUUID=l.h[e.location.NAME.toUpperCase()][e.view].UUID:e.view==o.a.VIEWS.PROJECT&&(a.cType=l.m.LOCATIONS.SUB_COMMAND_AREA),a},e.prototype.getPostDataForTable=function(e){var a={eDate:e.eDate,sDate:e.sDate,pUUID:e.pUUID,pType:e.pType,format:e.timeStep,cType:e.cType,pEUUID:e.pUUID,src:e.src,aggr:"LATEST",viewPEUUID:e.pEUUID,view:e.view};return e.location.NAME==o.a.LOCATION_LEVEL.TAMILNADU&&e.view==o.a.VIEWS.BASIN&&(a.viewPEUUID=l.h[e.location.NAME.toUpperCase()][e.view].UUID),a},e.prototype.getPostDataForChart=function(e){return{eDate:e.eDate,sDate:e.sDate,pUUID:e.pUUID,pType:e.pType,format:e.timeStep,cType:e.cType,pEUUID:e.pEUUID,src:e.src,aggr:"LATEST",optionalPeriodList:["Last Year Storage","Last 10 Year Average Storage"]}},e.prototype.getPostDataForDepthClass=function(e){return{eDate:this.utilsService.getDateInFormatFromModelDate(this.visibilityUtils.getLastDayForGivenModelDate(e.eDate,e.maxDate),l.m.DATEPICKER_DATE_FORMAT.DAY),sDate:this.utilsService.getDateInFormatFromModelDate(this.visibilityUtils.getStartAndEndDatesForType(e.sDate,e.eDate,e.format,e.minDate).startDate,l.m.DATEPICKER_DATE_FORMAT.DAY),pUUID:e.pUUID,pType:e.pType,format:"DAILY",pEUUID:e.pEUUID,src:e.src,aggr:"LATEST"}},e.prototype.getPostDataForBreadCrumb=function(e){var a={locName:e.locName,locUUID:e.pUUID,locType:e.pType,component:e.component.toLowerCase(),view:e.view,src:e.src,pEUUID:e.pEUUID};return e.location.NAME==o.a.LOCATION_LEVEL.TAMILNADU&&e.view==o.a.VIEWS.BASIN&&(a.pEUUID=l.h[e.location.NAME.toUpperCase()][e.view].UUID),a},e.prototype.getPostDataForKPI=function(e){var a={eDate:e.eDate,sDate:e.sDate,pUUID:e.pUUID,pType:e.pType,format:e.timeStep,cType:"NONE",pEUUID:e.pUUID,src:e.src,aggr:"LATEST",viewPEUUID:e.pEUUID,view:e.view};return e.location.NAME==o.a.LOCATION_LEVEL.TAMILNADU&&e.view==o.a.VIEWS.BASIN&&(a.viewPEUUID=l.h[e.location.NAME.toUpperCase()][e.view].UUID),a},e.prototype.getPostDataForLocTypes=function(e){return{pEUUID:e.pEUUID,component:e.component,srcUUID:e.srcUUID,view:e.view+"_HIERARCHY"}},e.ngInjectableDef=p.cb({factory:function(){return new e(p.gb(y.c),p.gb(i.a),p.gb(n.a),p.gb(s.a))},token:e,providedIn:"root"}),e}()},"7HLZ":function(e,a,t){"use strict";t.d(a,"b",function(){return n}),t.d(a,"a",function(){return s}),t("AytR");var r,i,o,l,n={LOCATIONS:{TELANGANA:"TELANGANA",GODAVARI:"GODAVARI",INDIA:"INDIA",STATE:"STATE",DISTRICT:"DISTRICT",MANDAL:"MANDAL",MITANK:"MITANK",RAINFALL:"RAINFALL",GROUNDWATER:"GROUNDWATER",BASIN:"BASIN",ALL:"ALL",RESERVOIR:"RESERVOIR","Sri Ram Sagar Project":"Sri Ram Sagar Project","Lower Manair Dam":"Lower Manair Dam",SRSP:"Sri Ram Sagar Project"},VIEWS:{ADMIN:"ADMIN",BASIN:"BASIN",ALL:"ALL",PROJECT:"PROJECT"},COMPONENT:{RAINFALL:"RAINFALL",MITANK:"MITANK",GROUNDWATER:"GROUNDWATER",CROPCOVERAGE:"CROPCOVERAGE",MITANKS:"MITANKS"},SOURCES:{ALL:"ALL",SENTINEL1:"SENTINEL1",SENTINEL2:"SENTINEL2",SENTINEL_1:"SENTINEL_1",SENTINEL_2:"SENTINEL_2",SENTINEL1_DEM:"SENTINEL1_DEM",SENTINEL2_DEM:"SENTINEL2_DEM",STATE_AND_CENTRAL_STATIONS:"STATE_AND_CENTRAL_STATIONS",STATE_STATIONS:"STATE_STATIONS",GEOSERVER:"GEOSERVER",BACKEND:"BACKEND",IMD_GRID:"IMD_GRID",IMD_STATIONS:"IMD_STATIONS"},DATEPICKER_DATE_FORMAT:{YEAR:"yyyy",MONTH:"yyyyMM",DAY:"yyyyMMdd",SEASON:"season"},DATE_FORMAT:(r={},r.yyyy="Yearly",r.yyyyMM="Monthly",r.yyyyMMdd="Daily",r.season="Season",r)},s=((i={})[n.LOCATIONS.STATE]={MIN:6,MAX:18},i[n.LOCATIONS.BASIN]={MIN:6,MAX:9},i[n.LOCATIONS.DISTRICT]={MIN:6,MAX:10},i[n.LOCATIONS.MANDAL]={MIN:10,MAX:18},i[n.LOCATIONS.MITANK]={MIN:11,MAX:18},i[n.LOCATIONS.RAINFALL]={MIN:6,MAX:18},i[n.LOCATIONS.GROUNDWATER]={MIN:6,MAX:18},i);(o={})[n.LOCATIONS.TELANGANA]=[17.638787196813762,78.55861865667588],o[n.LOCATIONS.GODAVARI]=[18.387606552494624,77.74710395866968],o[n.LOCATIONS.INDIA]=[17.8,79.06],(l={})[n.LOCATIONS.TELANGANA]=8,l[n.LOCATIONS.GODAVARI]=7,l[n.LOCATIONS.INDIA]=6},OMoY:function(e,a,t){"use strict";var r=t("4R65"),i=(t("iNfD"),t("BRqF"),t("MCLT")),o=t("wd/R"),l=t("S+eF"),n=t("XQuM"),s=t("XWfP"),p=t("7Amg"),y=t("AytR"),u=t("rhxO"),c=t("q4vc"),m=t("6QN/"),h=t("m1qP"),d=t("8KMR"),v=t("zKbe"),f=t("7HLZ"),g=t("abfC"),L=t("CcnG"),A=t("t/Na");t.d(a,"a",function(){return D});var T=function(){return(T=Object.assign||function(e){for(var a,t=1,r=arguments.length;t<r;t++)for(var i in a=arguments[t])Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i]);return e}).apply(this,arguments)},O=function(e,a,t,r){return new(t||(t=Promise))(function(i,o){function l(e){try{s(r.next(e))}catch(a){o(a)}}function n(e){try{s(r.throw(e))}catch(a){o(a)}}function s(e){e.done?i(e.value):new t(function(a){a(e.value)}).then(l,n)}s((r=r.apply(e,a||[])).next())})},S=function(e,a){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function n(o){return function(n){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=(i=l.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=a.call(e,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,n])}}},D=function(){function e(e,a,t,r,i,o,l,n,s){var p=this;this.injector=e,this.pdService=a,this.gisUtils=t,this.utilsService=r,this.gisPopupService=i,this.http=o,this.gisSvgService=l,this.dataService=n,this.impactMapService=s,this.urlConstants=y.a.url,this.maxCapacity=313,this.minCapacity=.4,this.minRadius=4,this.maxRadius=30,this.next24hrRainfall={},this.next3DaysRainfall={},this.next3to5DaysRainfall={},this.last3DaysRainfall={},this.gisUtils.getSelectedParams().subscribe(function(e){p.utilsService.isEmptyObj(e)||(p.params=e)})}return e.prototype.addBaseTileLayers=function(e,a){var t={};for(var r in e){var i,o=e[r];i=this.addTileLayer(o),o.visible?(a.removeLayer(i),a.addLayer(i)):a.removeLayer(i),t[o.name]=i}return t},e.prototype.addTileLayer=function(e){return"Google Satellite"===e.name?r.tileLayer.colorFilter(e.url,e):new r.TileLayer(e.url,e)},e.prototype.getApplicationBasedLayer=function(e,a,t){return"WMS"==a?this.getWMSOverLays(e,t):"GEOJSON"==a?this.getGEOJSONOverLays(e):"HEATMAP"==a?this.getHeatMapOverlays(e,{}):void 0},e.prototype.getWMSOverLays=function(e,a){var t={};for(var i in e)if(e.hasOwnProperty(i)){var o=e[i],l={};l.name=o.name,l.type="wms",l.component=o.component,l.layerOptions={},o.cType&&o.cType.length>0&&(l.layerOptions.cType=o.cType),a&&a.pUUID&&(l.layerOptions.pUUID=a.pUUID),l.layerOptions.name=o.name,l.layerOptions.format="image/png",l.layerOptions.transparent=!0,l.url="State Names"===l.name?this.urlConstants.GEOSERVER_URL+"forecast/ows":l.name&&l.name.includes("Sentinel")&&!l.name.includes("Depth")?o.url:this.getGeoServerURL()+"/wms",this.validateValue(o.hasLegend)&&(l.layerOptions.hasLegend=o.hasLegend),this.validateValue(o.legendName)&&(l.layerOptions.legendName=o.legendName),this.validateValue(o.key)&&(l.layerOptions.key=o.key),this.validateValue(o.view)&&(l.layerOptions.view=o.view),this.validateValue(o.displayName)&&(l.layerOptions.displayName=o.displayName),this.validateValue(o.imagesrc)&&(l.layerOptions.imagesrc=o.imagesrc),this.validateValue(o.source)&&(l.layerOptions.source=o.source),this.validateValue(o.layer_name)&&(l.layerOptions.layer_name=o.layer_name),this.validateValue(o.cql_filter)&&(l.layerOptions.cql_filter=o.cql_filter),this.validateValue(o.subgroup)&&(l.layerOptions.subgroup=o.subgroup),this.validateValue(o.visible)&&(l.layerOptions.visible=o.visible),this.validateValue(o.dashboardView)&&(l.layerOptions.dashboardView=o.dashboardView),this.validateValue(o.group)&&(l.layerOptions.group=o.group),this.validateValue(o.layeroptions_name)&&(l.layerOptions.layers=o.layeroptions_name),this.validateValue(o.layeroptions_min_zoom)&&(l.layerOptions.minZoom=o.layeroptions_min_zoom),this.validateValue(o.layeroptions_max_zoom)&&(l.layerOptions.maxZoom=o.layeroptions_max_zoom),this.validateValue(o.layeroptions_pane)&&(l.layerOptions.pane=o.layeroptions_pane),this.validateValue(o.layeroptions_zindex)&&(l.layerOptions.zIndex=o.layeroptions_zindex),this.validateValue(o.cql_filter_value)&&(l.layerOptions.cql_filter_value=o.cql_filter_value),this.validateValue(o.type)&&(l.layerOptions.type=o.type),this.validateValue(o.layeroptions_show_on_selector)&&!o.layeroptions_show_on_selector&&(l.layerOptions.showOnSelector=o.layeroptions_show_on_selector),this.validateValue(o.group_type)&&(l.layerOptions.groupType=o.group_type),this.validateValue(o.data)&&(l.layerOptions.data=o.data),this.validateValue(o.crs)&&"EPSG4326"==o.crs&&(l.layerOptions.crs=r.CRS.EPSG4326),this.validateValue(o.position)&&(l.layerOptions.position=o.position),"WMS"===o.type&&("Sentinel 1"===l.name||"Sentinel 2 FCC"===l.name||"Sentinel 2 TCC"===l.name||l.name.includes("ALOS")?(l.key=l.name,t[l.name]=l):(l.key=i,t[i]=l)),this.validateValue(o.layeroptions_styles)&&(l.layerOptions.STYLES=o.layeroptions_styles),this.validateValue(o.info)&&(l.layerOptions.info=o.info)}return t},e.prototype.getGEOJSONOverLays=function(e){var a={};for(var t in e)if(e.hasOwnProperty(t)){var i=e[t],o={};o.name=i.name,o.type="GEOJSON",o.layerOptions={},i.cType&&i.cType.length>0&&(o.cType=i.cType,o.layerOptions.cType=i.cType),o.layerOptions.type="GEOJSON",o.layerOptions.name=i.name,o.layerOptions.format="image/png",o.layerOptions.transparent=!0,this.validateValue(i.hasLegend)&&(o.layerOptions.hasLegend=i.hasLegend),this.validateValue(i.legendName)&&(o.layerOptions.legendName=i.legendName),this.validateValue(i.legendData)&&(o.layerOptions.legendData=i.legendData),this.validateValue(i.component)&&(o.layerOptions.component=i.component),this.validateValue(i.view)&&(o.layerOptions.view=i.view),this.validateValue(i.layer_name)&&(o.layerOptions.layer_name=i.layer_name),this.validateValue(i.cql_filter)&&(o.layerOptions.cql_filter=i.cql_filter),this.validateValue(i.cql_filter_value)&&(o.layerOptions.cql_filter_value=i.cql_filter_value),this.validateValue(i.source)&&(o.layerOptions.source=i.source),this.validateValue(i.visible)&&(o.layerOptions.visible=i.visible),this.validateValue(i.layerFrom)&&(o.layerOptions.layerFrom=i.layerFrom),this.validateValue(i.includeAll)&&(o.layerOptions.includeAll=i.includeAll),this.validateValue(i.displayName)&&(o.layerOptions.displayName=i.displayName),this.validateValue(i.style)&&(o.layerOptions.style=i.style),this.validateValue(i.onEachFeature)&&(o.layerOptions.onEachFeature=i.onEachFeature),this.validateValue(i.pointToLayer)&&(o.layerOptions.pointToLayer=i.pointToLayer),this.validateValue(i.afterLayerAddition)&&(o.layerOptions.afterLayerAddition=i.afterLayerAddition),this.validateValue(i.group)&&(o.layerOptions.group=i.group),this.validateValue(i.canalWMSLayer)&&(o.layerOptions.canalWMSLayer=i.canalWMSLayer),this.validateValue(i.layeroptions_name)&&(o.layerOptions.layers=i.layeroptions_name),this.validateValue(i.layeroptions_min_zoom)&&(o.layerOptions.minZoom=i.layeroptions_min_zoom),this.validateValue(i.layeroptions_max_zoom)&&(o.layerOptions.maxZoom=i.layeroptions_max_zoom),this.validateValue(i.layeroptions_pane)&&(o.layerOptions.pane=i.layeroptions_pane),this.validateValue(i.layeroptions_zindex)&&(o.layerOptions.zIndex=i.layeroptions_zindex),this.validateValue(i.layeroptions_show_on_selector)&&!i.layeroptions_show_on_selector&&(o.layerOptions.showOnSelector=i.layeroptions_show_on_selector),this.validateValue(i.group_type)&&(o.layerOptions.groupType=i.group_type),this.validateValue(i.data)&&(o.layerOptions.data=i.data),this.validateValue(i.crs)&&"EPSG4326"==i.crs&&(o.layerOptions.crs=r.CRS.EPSG4326),this.validateValue(i.position)&&(o.layerOptions.position=i.position),"GEOJSON"===i.type&&(o.key=t,a[t]=o),this.validateValue(i.layeroptions_styles)&&(o.layerOptions.STYLES=i.layeroptions_styles),this.validateValue(i.info)&&(o.layerOptions.info=i.info)}return a},e.prototype.getHeatMapOverlays=function(e,a){var t={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],o={};o.name=i.name,o.type="image",o.layerOptions={},o.layerOptions.name=i.name,this.validateValue(a[o.name])&&this.validateValue(i.group_type)&&(o.layerOptions.groupType=i.group_type),this.validateValue(i.component)&&(o.layerOptions.component=i.component),this.validateValue(i.hasLegend)&&(o.layerOptions.hasLegend=i.hasLegend),this.validateValue(i.key)&&(o.layerOptions.key=i.key),this.validateValue(i.legendName)&&(o.layerOptions.legendName=i.legendName),this.validateValue(i.legendData)&&this.validateValue(i.subgroup)&&(o.layerOptions.subgroup=i.subgroup),this.validateValue(i.displayName)&&(o.layerOptions.displayName=i.displayName),this.validateValue(i.visible)&&(o.layerOptions.visible=i.visible),this.validateValue(i.group)&&(o.layerOptions.group=i.group),this.validateValue(i.type)&&(o.layerOptions.type=i.type),this.validateValue(i.layeroptions_name)&&(o.layerOptions.layerName=i.layeroptions_name),this.validateValue(i.layeroptions_pane)&&(o.layerOptions.pane=i.layeroptions_pane),this.validateValue(i.layeroptions_min_zoom)&&(o.layerOptions.minZoom=i.layeroptions_min_zoom),this.validateValue(i.layeroptions_max_zoom)&&(o.layerOptions.maxZoom=i.layeroptions_max_zoom),this.validateValue(i.layeroptions_show_on_selector)&&!i.layeroptions_show_on_selector&&(o.layerOptions.showOnSelector=i.layeroptions_show_on_selector),"HEATMAP"!==i.type||this.validateValue(i.image_path)?"HEATMAP"===i.type&&this.validateValue(i.image_path)&&(o.url=i.image_path,t[r]=o):this.validateValue(a[o.name])?(o.url=a[o.name].url,t[r]=o):(o.url=a[i.layeroptions_name],t[r]=o),this.validateValue(i.info)&&(o.layerOptions.info=i.info)}return t},e.prototype.setWMSOverlays=function(e,a,t){var i={};for(var o in a)if(a.hasOwnProperty(o)){var l,n=a[o];n.layerOptions.cql_filter||(n.layerOptions.cql_filter="1=1"),l=new r.TileLayer.WMS(n.url,"SRTM_DEM_30"==o?{layers:n.layerOptions.layers,format:"image/png",transparent:!0,attribution:n.layerOptions.attribution||"",minZoom:n.layerOptions.minZoom,maxZoom:n.layerOptions.maxZoom,pane:n.layerOptions.pane,styles:n.layerOptions.STYLES}:n.layerOptions),i[o]=l,t&&e.hasLayer(t[o])&&e.removeLayer(t[o]),o.startsWith("Depth_Class")||!0===n.layerOptions.visible&&e.addLayer(i[o])}return i},e.prototype.setImageLayers=function(e,a,t,i){var o={opacity:.8,pane:"heatMap",minZoom:6,maxZoom:15,clip:i.bbox},l=this.pdService.setHeatMapData(i.heatmapData),n={};for(var s in a)if(a.hasOwnProperty(s)){var p=a[s];if(null!=l.url&&null!=l.url){var y=this.getImageBounds(l.bounds),u=r.imageTransform(l.url,y,o);n[s]=u,n[s].options=Object.assign(p.layerOptions,o),e.hasLayer(t[s])&&e.removeLayer(t[s]),!0===p.layerOptions.visible&&e.addLayer(n[s])}}return n},e.prototype.setGEOJSONOverlays=function(e,a,t,o,l,n){return O(this,void 0,void 0,function(){var t=this;return S(this,function(s){return l.spinner=!0,[2,new Promise(function(s,p){return O(t,void 0,void 0,function(){var t,p,y,u,c,m,h,d,v,f;return S(this,function(g){switch(g.label){case 0:for(u in t={},p=null,y=[],a)y.push(u);c=0,g.label=1;case 1:return c<y.length?(m=y[c],h=new r.LayerGroup,"GEOJSON"!==(d=a[m]).type||"BACKEND"!=d.layerOptions.layerFrom?[3,3]:[4,this.injector.get(o.serviceType)[o.sensorLayerFunctionName](this,d,e)]):[3,8];case 2:return h=g.sent(),[3,6];case 3:return"GEOJSON"!==d.type||"GEOSERVER"!=d.layerOptions.layerFrom?[3,6]:(v=d.layerOptions.layers.split("kaleshwaram:"),p=this.getFilterForMITanks(d.layerOptions),Object(i.isNullOrUndefined)(v[1])?[3,6]:[4,this.getGeoJsonLayerData(v[1],p,o)]);case 4:return f=g.sent(),[4,this.addGeoJsonLayersToMap(f,e,d.layerOptions,o,this.params,l)];case 5:h=g.sent(),g.label=6;case 6:h.options=T({},d,h.options),t[m]=h,t[m].options=T({},t[m].options,h.options.layerOptions),!Object(i.isNullOrUndefined)(e)&&!Object(i.isNullOrUndefined)(t[m])&&this.checkZoomlevelsForGeoJSON(t[m].options,e.getZoom())&&t[m].options.visible&&(e.hasLayer(t[m])&&e.removeLayer(t[m]),e.hasLayer(t[m])||e.addLayer(t[m])),"Command Area"==m&&"command"==n&&e.fitBounds(t[m].getBounds()),"Catchment Area"==m&&"catchment"==n&&e.fitBounds(t[m].getBounds()),g.label=7;case 7:return c++,[3,1];case 8:return l.spinner=!1,s(t),[2]}})})})]})})},e.prototype.addGeoJsonLayersToMap=function(e,a,t,i,o,l){var n=this,s=this;return r.geoJSON(e,{pane:t.pane,cacheLayers:!0,style:function(e){if(t.style)return s[t.style](e)},pointToLayer:function(e,r){if(t.pointToLayer)return n[t.pointToLayer](r,e,a)},onEachFeature:function(e,r){if(t.onEachFeature)return n[t.onEachFeature](r,a)}})},e.prototype.getGeoJsonLayerData=function(e,a,t){var r=this,i={};return new Promise(function(o,l){r.pdService.getLayerWithFilter(e,a).subscribe(function(a){return O(r,void 0,void 0,function(){return S(this,function(r){switch(r.label){case 0:return i=a,a?"reservoirs_20210930_total_v1"!=e?[3,2]:[4,this.formatReservoirData(a,t)]:[3,3];case 1:return i=r.sent(),[3,3];case 2:i=a,r.label=3;case 3:return o(i),[2]}})})})})},e.prototype.stylingforGeoJson=function(e){return{fillColor:e.properties.color,opacity:.8,color:"#000000",fillOpacity:0,weight:.8}},e.prototype.stylingforReservoir=function(e){return{fillColor:e.properties.color,opacity:1,color:"#000080",fillOpacity:1,weight:1}},e.prototype.handleReservoirPolygon=function(e,a){var t=this;e.on({click:function(i){var o=i.target.feature.properties,l=i.target.feature.properties.display__1;"Sita Rama LIS/Dummugudem Anicut"==l&&(l="Sitamma Sagar",o.display__1="Sitamma Sagar");var n=t.gisPopupService.getGisProjectDashboardViewPopup(l,o,t.next24hrRainfall,t.next3DaysRainfall,t.next3to5DaysRainfall,t.last3DaysRainfall);s.responsivePopup({hasTip:!0,autoPan:!0,offset:[1,2],minWidth:290,maxWidth:290,closeButton:!1}).setLatLng(i.latlng).setContent(n).openOn(a),r.Browser.ie||r.Browser.edge||e.bringToFront()}})},e.prototype.getForecastRainfallData=function(){var e=this,a=this.gisSvgService.getForecastPostData(),t=this.gisSvgService.getForecastNdayList(5),r=[t[0]],i=[t[0],t[1],t[2]],o=[t[3],t[4]];this.dataService.getForecastRainfallData(a).subscribe(function(a){for(var t in a){var l=e.gisSvgService.getWaterSourceNameFromUUID(t,"ANY");e.next24hrRainfall[l]={},e.next3DaysRainfall[l]={},e.next3to5DaysRainfall[l]={},e.next24hrRainfall[l].rfLevel=0,e.next3DaysRainfall[l].rfLevel=0,e.next3to5DaysRainfall[l].rfLevel=0,e.next24hrRainfall[l].rfStorage=0,e.next3DaysRainfall[l].rfStorage=0,e.next3to5DaysRainfall[l].rfStorage=0;var n=a[t];for(var s in n){var p=n[s]&&n[s].mm?n[s].mm:0,y=n[s]&&n[s].TMC?n[s].TMC:0;r.includes(s)&&(e.next24hrRainfall[l].rfLevel=e.next24hrRainfall[l].rfLevel+parseFloat(p),e.next24hrRainfall[l].rfStorage=e.next24hrRainfall[l].rfStorage+parseFloat(y)),i.includes(s)&&(e.next3DaysRainfall[l].rfLevel=e.next3DaysRainfall[l].rfLevel+parseFloat(p),e.next3DaysRainfall[l].rfStorage=e.next3DaysRainfall[l].rfStorage+parseFloat(y)),o.includes(s)&&(e.next3to5DaysRainfall[l].rfLevel=e.next3to5DaysRainfall[l].rfLevel+parseFloat(p),e.next3to5DaysRainfall[l].rfStorage=e.next3to5DaysRainfall[l].rfStorage+parseFloat(y))}}},function(e){})},e.prototype.getLast3DaysRainfall=function(){var e=this,a=new Date,t=new Date(a.setDate(a.getDate()-3));t.setHours(8),t.setMinutes(30),t.setSeconds(0),a=new Date;var r=new Date(a.setDate(a.getDate()));r.setHours(8),r.setMinutes(29),r.setSeconds(0);var i=this.gisSvgService.getResevoirandRiverGaugeLast3DayAggPostData();this.dataService.getLast3dayCatchmentRainfall(i).subscribe(function(a){for(var t in a){var r=a[t];e.last3DaysRainfall[r.nm]=r}},function(e){})},e.prototype.formatReservoirData=function(e,a){var t=this,r=this.pdService.getLast3DayReservoirPostData(a);return new Promise(function(a,i){t.pdService.getAllStorageDataForSvg(r).subscribe(function(r){t.allReservoirsData=r;var i={};for(var l in r){var n=r[l];i[n.ln]={egt:n.lts||n.lts>=0?n.lts:null,ext:n.ext||n.ext>=0?n.ext:null,dsc:n.dsc||n.dsc>=0?n.dsc:null,dex:n.dex||n.dex>=0?n.dex:null,cl:n.cl||n.cl>=0?n.cl:null,st:n.tSt||n.tst>=0?n.tSt:null,p:n.pfill||n.pfill>=0?n.pfill:null,lt:n.lt||n.lt>=0?n.lt:null,i:n.inf||n.inf>=0?n.inf:null,pi:n.ifpump||n.ifpump>=0?n.ifpump:null,ni:n.inf&&n.ifpump&&n.inf>=0&&n.ifpump>=0?n.inf-n.ifpump:null,o:n.ofl||n.oft>=0?n.ofl:null,nog:n.nog||n.nog>=0?n.nog:null,ft:n.ft||n.ft>=0?n.ft:null,sr:n.lsrc?n.lsrc:"-",se:n.se||n.se>=0?n.se:null,mxi:n.hin||n.hin>=0?n.hin:null,mxo:n.hout||n.hout>=0?n.hout:null,mit:n.hints||n.hints>=0?t.utilsService.getSimpleDateStringWithoutTime(n.hints):null,mot:n.houts||n.houts>=0?t.utilsService.getSimpleDateStringWithoutTime(n.houts):null,msl:n.msl||n.msl>=0?n.msl:null,an:n.an||n.an>=0?n.an:null,md:{n:n.ln?n.ln:null,lUUID:n.lUUID?n.lUUID:null,t:n.t?n.t:null,s:n.st?n.st:null,b:n.bn?n.bn:null,d:n.d||n.d>=0?n.d:null,frl:n.frl||n.frl>=0?n.frl:null,dsl:n.dsl||n.dsl>=0?n.dsl:null,lh:n.lh||n.lh>=0?n.lh:null,gc:n.tca||n.tca>=0?n.tca:null,dc:n.dc||n.dc>=0?n.dc:null,pc:n.pc||n.pc>=0?n.pc:null,dl:n.dl||n.dl>=0?n.dl:null,wl:n.wl||n.wl>=0?n.wl:null,hf:n.hf||n.hf>=0?n.hf:null,la:n.lat||n.lat>=0?n.lat:null,lg:n.lng||n.lng>=0?n.lng:null},rd:n.rd?null!=n.rd?n.rd:null:{}}}r=i;var s,p,y={};for(var l in r){var u=r[l];(!s||u.md.gc>s)&&(s=u.md.gc),(!p||u.md.gc<p)&&(p=u.md.gc)}for(var l in r){var c,m,h=r[l],d=h.cl||h.cl>=0?h.cl:null,v=h.md.frl||h.md.frl>=0?h.md.frl:null,f=h.st||h.st>=0?h.st:null,g=h.md.gc||h.md.gc>=0?h.md.gc:null,L=h.i||h.i>=0?h.i:null,A=h.o||h.o>=0?h.o:null,T=h.mxi||h.mxi>=0?h.mxi:null,O=h.mxo||h.mxo>=0?h.mxo:null,S=h.ni||h.ni>=0?h.ni:null,D=h.pi||h.pi>=0?h.pi:null,N=h.egt||h.egt>=0?h.egt:null,E=h.ft||h.ft>=0?h.ft:null,b=h.md.b||null!=h.md.b?h.md.b:"-",_=h.md.n||null!=h.md.n?h.md.n:"-",I=h.md.lUUID||null!=h.md.lUUID?h.md.lUUID:"-",C=h.sr||null!=h.sr?h.sr:"-",M=h.mot||h.mot>=0?h.mot:null,R=h.mit||h.mit>=0?h.mit:null,P=h.egt||h.egt>=0?h.egt:null,w=h.md.la||h.md.la>=0?h.md.la:null,U=h.md.lg||h.md.lg>=0?h.md.lg:null;c=d&&parseFloat(v)>0?(d/v*100).toFixed(1):"-",m=f&&parseFloat(g)>0?(f/g*100).toFixed(1):"-";var V=h.md.lh,x=h.pd,F=h.dv,B=t.getFillColor(m);P=P?o(P).format("DD-MM-YYYY h:mm:ss"):"-";var G=3,k=3+h.md.gc/s*7;(h.st||"0"==h.st)&&(G=3+h.st/g*7),G>k&&(G=3),y[I]={cl:d?t.utilsService.fixedToDecimal(d,2):"-",frl:v?t.utilsService.fixedToDecimal(v,2):"-",storage:f?t.utilsService.fixedToDecimal(f,2):"-",gc:g?t.utilsService.fixedToDecimal(g,2):"-",inflow:L,outflow:A,maximumInflow:T,maximumOutflow:O,naturalInflow:S,pumpinInflow:D,egt:N,ft:E,basin:b,resName:_,resId:I,dataSource:C,highOutflowTime:M,highInflowTime:R,currentTime:P,latitude:w?w.toFixed(2):"-",longitude:U?U.toFixed(2):"-",innerRadius:G,outerRadius:k,rfLevelpercent:c,rfStoragepercent:m,color:B,lh:V,pd:x,dv:F}}for(var W=0;W<e.features.length;W++)Object.assign(e.features[W].properties,y[e.features[W].properties.location_1]);t.getLast3DaysRainfall(),t.getForecastRainfallData(),a(e)})})},e.prototype.getFillColor=function(e){return e>90?"#d7191c":e>80?"#e66101":e>70?"#003399":e>50?"#3366cc":e>30?"#66ccff":e<30?"#ccffff":e?void 0:"gray"},e.prototype.addReservoirPointLayer=function(e,a,t,i){var o,l=this,n={stroke:!0,fill:!0,color:"#ffffff",weight:1,opacity:1,fillColor:"#1F77B4",fillOpacity:.5,radius:10,pane:"markers"},p=a.getZoom(),y=(s.responsivePopup({hasTip:!0,autoPan:!1,minWidth:250,pane:"popUpGeoJson",maxWidth:300,closeButton:!1}),new r.LayerGroup),u=this.reservoirData?this.reservoirData[e.properties.uuid]:void 0;o=[e.geometry.coordinates[1],e.geometry.coordinates[0]];var c=e.properties.outerRadius?e.properties.outerRadius:this.minRadius;n.radius=this.getCircleMarkerRadius(p,c);var m=r.circleMarker(o,n);y.addLayer(m);var h={stroke:!0,fill:!0,color:"#ffffff",weight:1,opacity:1,fillColor:"#66ccff",fillOpacity:.8,radius:15,pane:"markers"},d=e.properties.innerRadius?e.properties.innerRadius:this.minRadius;h.radius=this.getCircleMarkerRadius(p,d),h.fillColor=u&&u.color?u.color:"#66ccff";var v=r.circleMarker(o,h);return y.addLayer(v),v.on({mouseover:function(e){},mouseout:function(e){},click:function(e){}}),a.on({zoomend:function(e){var t=a.getZoom();m.setRadius(l.getCircleMarkerRadius(t,c)),v.setRadius(l.getCircleMarkerRadius(t,d))}}),y},e.prototype.getCircleMarkerRadius=function(e,a){return a*e*.25},e.prototype.getRadius=function(e){e=Number(e);var a=this.minRadius;return null!=e&&(a=this.minRadius+e/this.maxCapacity*(this.maxRadius-this.minRadius)),a},e.prototype.getFilterForMITanks=function(e){return e.cql_filter||null},e.prototype.checkZoomlevelsForGeoJSON=function(e,a){return!!(e&&e.maxZoom&&e.minZoom&&e.maxZoom>=a&&e.minZoom<=a&&e.visible)},e.prototype.getGeoServerURL=function(e){var a=this.urlConstants.GEOSERVER_URL+"kaleshwaram";return e&&(a=this.urlConstants.GEOSERVER_URL_SECOND+"VASSARLABS"),a},e.prototype.validateValue=function(e){return!Object(i.isNullOrUndefined)(e)},e.prototype.createLayer=function(e,a){return"HeatMap"==e.serviceType?this.createHeatMapLayer(e,a):"WmsLayer"==e.serviceType?this.createWmsLayer(e,a):"VectorLayer"==e.serviceType?this.createVectorLayer(e,a):new Promise(function(e,a){e(!0)})},e.prototype.createVectorLayer=function(e,a){var t=this,i={interactive:!0,rendererFactory:{},opacity:1,minZoom:5,maxZoom:18,pane:"district",visible:!0,transparent:!0,vectorTileLayerStyles:{},getFeatureId:{}};null!=e.min&&null!=e.min&&(i.minZoom=e.min),null!=e.max&&null!=e.max&&(i.maxZoom=e.max),i.rendererFactory=r.canvas.tile,i.getFeatureId=function(e){return"Godavari Basin"==e.properties.ba_name||"Godavari"==e.properties.ba_name?e.properties.uuid:e.properties.loc_uuid},i.vectorTileLayerStyles[e.layerName]=function(a,t){if("corewris_kwaram_telangana_district"==e.layerName)if(t>=10)var r={opacity:1,color:"black",weight:1.2};else r={opacity:0,color:"",weight:1};else r={opacity:0,color:"",weight:1};return r},e.layer=r.vectorGrid.protobuf("DISTRICT"==e.layerNameType||"BLOCK"==e.layerNameType||"BASIN"==e.layerNameType||"SUBBASIN"==e.layerNameType?this.urlConstants.GEOSERVER_URL_SECOND+"VASSARLABS/gwc/service/wmts?layer=VASSARLABS:"+e.layerName+"&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=application/x-protobuf;type=mapbox-vector&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}":n.a.GEOSERVER_WMTS_URL+"&layer="+n.a.GEOSERVER_WORKSPACE_NAME+":"+e.layerName,i);var o=0;return a.map.on({dblclick:function(e){o=1}}),e.interactive?e.layer.on({click:function(e){return O(t,void 0,void 0,function(){return S(this,function(a){switch(a.label){case 0:return[4,Object(l.delay)(300)];case 1:return a.sent(),o>0?[4,Object(l.delay)(1e3)]:[3,3];case 2:return a.sent(),o=0,[2];case 3:return this.gisUtils.setMapLayerData(e),[2]}})})},mouseover:function(a){"SUBBASIN"==e.layerNameType?e.layer.setFeatureStyle(a.layer.properties.uuid,{color:"black",weight:.5}):"DISTRICT"==e.layerNameType&&e.layer.setFeatureStyle(a.layer.properties.loc_uuid,{color:"black",weight:1})},mouseout:function(a){"SUBBASIN"==e.layerNameType?e.layer.resetFeatureStyle(a.layer.properties.uuid):"DISTRICT"==e.layerNameType&&e.layer.resetFeatureStyle(a.layer.properties.loc_uuid)}}):(e.layer.options.interactive=!1,"BASIN"==e.layerNameType&&e.layer.setFeatureStyle(p.c.GODAVARI_UUUID,{color:"black",weight:1})),e},e.prototype.createWmsLayer=function(e,a){var t={layers:e.layerName,opacity:1,format:"image/png",visible:!0,transparent:!0,pane:e.zIndex?e.zIndex:"district",fadeAnimation:!1,attribution:"<a href = 'https://mausam.imd.gov.in/'> Data Source : ECMWF </a>"};return null!=e.minZoom&&null!=e.minZoom&&(t.minZoom=e.minZoom),null!=e.stateName&&null!=e.stateName&&(t.viewParams="stateName:"+e.stateName),null!=e.env&&null!=e.env&&(t.env=e.env),null!=e.cql_filter&&null!=e.cql_filter&&(t.cql_filter=e.cql_filter),e.layer=r.tileLayer.wms(n.a.GEOSERVER_WMS_URL,t),e},e.prototype.createHeatMapLayer=function(e,a){var t=this;return new Promise(function(i,o){var l={opacity:.8,pane:"heatMap",minZoom:6,maxZoom:15};t.getShapeBoundaryLayers(a.sidebarParams.viewType,e.clip,e.stateName,a).then(function(o){null!=o&&(l.clip=o),null!=e.url&&null!=e.url&&t.pdService.getHeatMap(e.url).then(function(o){if(null!=o.url&&null!=o.url){var n=t.getImageBounds(o.bounds);e.layer=r.imageTransform(o.url,n,l),e.layer.addTo(a.map),a.map.removeLayer(e.layer)}i(e)})})})},e.prototype.getShapeBoundaryLayers=function(e,a,t,r){var i=this;return new Promise(function(o,l){0==a&&o(null),"command"==e?null==i.stateBoundary||null==i.stateBoundary?i.http.get(n.a.KALESHWARAM_GEOJSON_LAYER_URL+"&typeName="+n.a.KALESHWARAM_WORKSPACE_NAME+":"+p.c.STATE_TO_LAYERTYPE_NAME[t+"_COMMAND_BOUNDARY"]+"&viewParams=stateName:"+t+"&cql_filter=project_uuid ='"+r.urlParams.locId+"'").subscribe(function(e){i.stateBoundary=e.features[0].geometry,o(i.stateBoundary)}):o(i.stateBoundary):null==i.basinBoundary||null==i.basinBoundary?i.http.get("http://159.65.4.230/geoserver/kaleshwaram/ows?service=WFS&version=1.0.0&request=GetFeature&maxFeatures=50&outputFormat=application%2Fjson&typeName=kaleshwaram:"+p.c.STATE_TO_LAYERTYPE_NAME[t+"_CATCHMENT_BOUNDARY"]+"&viewParams=stateName:"+p.c.STATENAME+"&cql_filter=point_uuid ='"+r.urlParams.locId+"'").subscribe(function(e){i.basinBoundary=e.features[0].geometry,o(i.basinBoundary)}):o(i.basinBoundary)})},e.prototype.getImageBounds=function(e){var a=[];return a.push([e[1][0],e[0][1]]),a.push([e[1][0],e[1][1]]),a.push([e[0][0],e[1][1]]),a.push([e[0][0],e[0][1]]),a},e.prototype.addTimeBasedLayers=function(e,a){return O(this,void 0,void 0,function(){var t,r,i,o,n,s,p,y;return S(this,function(u){switch(u.label){case 0:return e.playButtonDisable=!0,e.labelStrings=[],t=[],r=[],[4,Object(l.delay)(.1)];case 1:for(n in u.sent(),e.showThrobber=!0,i=function(i){var l=a[i];if("Time"==l.type&&l.time==e.forecastLength&&"true"==l.setDefault){var n=void 0;null!=l.layer&&null!=l.layer?(l.layer.addTo(e.map),e.activeGroup=l.groupName,e.activeLayers.push(l),null!=l.timeLineName&&null!=l.timeLineName&&(t[l.timeLinePos]={groupName:l.groupName,label:l.timeLineName,fullLabel:l.leftSideName}),n=new Promise(function(e){e(l)})):(n=o.createLayer(l,e)).then(function(r){null!=r.layer&&null!=r.layer&&(r.layer.addTo(e.map),e.activeGroup=r.groupName,e.activeLayers.push(r),null!=l.timeLineName&&null!=l.timeLineName&&(t[l.timeLinePos]={groupName:l.groupName,label:l.timeLineName,fullLabel:l.leftSideName})),a[i]=r}),r=r.concat(n)}},o=this,a)i(n);Promise.all(r).then(function(a){e.labelStrings=JSON.parse(JSON.stringify(t)),e.playButtonDisable=!1,e.showThrobber=!1}),s=1,p=0,y=4,u.label=2;case 2:return 0==s?[3,4]:[4,this.fetchTimeLayers(e,s,p,y,a,t).then(function(e){s=e})];case 3:return u.sent(),p=y,y+=4,[3,2];case 4:return null!=e.labelStrings[0]&&(e.initialCounter=parseInt(e.labelStrings[0].groupName,10),this.gisUtils.setLabelString(e.labelStrings)),[2]}})})},e.prototype.fetchTimeLayers=function(e,a,t,r,i,o){var l=this;return new Promise(function(a,n){var s=[],p=function(a){var n=i[a];if("Time"==n.type&&n.view==e.view&&n.time==e.forecastLength&&"false"==n.setDefault&&(null==n.type2||n.type2==e.minMax))if((null==n.layer||null==n.layer)&&n.timeLinePos>=t&&n.timeLinePos<r){var p=l.createLayer(n,e);p.then(function(e){i[a]=e,null!=e.layer&&null!=e.layer&&null!=n.timeLineName&&null!=n.timeLineName&&(o[n.timeLinePos]={groupName:n.groupName,label:n.timeLineName,fullLabel:n.leftSideName})}),s=s.concat(p)}else null!=n.layer&&null!=n.layer&&null!=n.timeLineName&&null!=n.timeLineName&&(o[n.timeLinePos]={groupName:n.groupName,label:n.timeLineName,fullLabel:n.leftSideName})};for(var y in i)p(y);Promise.all(s).then(function(t){e.labelStrings=JSON.parse(JSON.stringify(o)),a(s.length)})})},e.prototype.changeTimeLayers=function(e,a){if(a!=e.activeGroup){var t=e.activeGroup;e.activeGroup=a,this.removeGroupTimeLayers(e,t),this.addGroupTimeLayers(e,a)}},e.prototype.addGroupTimeLayers=function(e,a){for(var t in e.layerList){var r=e.layerList[t];"Time"==r.type&&r.time==e.forecastLength&&r.groupName==a&&r.view==e.view&&null!=r.layer&&null!=r.layer&&(r.layer.addTo(e.map),e.activeLayers.push(r))}},e.prototype.removeGroupTimeLayers=function(e,a){for(var t in e.activeLayers){var r=e.activeLayers[t];r.groupName==a&&"Time"==r.type&&(e.map.removeLayer(r.layer),e.activeLayers[t]="deleted")}e.activeLayers=e.activeLayers.filter(function(e){return"deleted"!=e})},e.prototype.removeAllTimeLayers=function(e){for(var a in e.activeLayers){var t=e.activeLayers[a];"Time"==t.type&&(e.map.removeLayer(t.layer),e.activeLayers[a]="deleted")}e.activeLayers=e.activeLayers.filter(function(e){return"deleted"!=e})},e.prototype.addMITanksPolygonLayerPd=function(e,a,t,i){return O(this,void 0,void 0,function(){var o,l=this;return S(this,function(n){return o=a.getZoom(),a.on({zoomend:function(t){var r=a.getZoom();e.setStyle(r<f.a[f.b.LOCATIONS.MITANK].MIN?{weight:1,fill:!0,fillColor:"#FFCCCC",color:"#005FED",fillOpacity:0,opacity:1,pane:"popUp",stroke:!0}:{weight:1,fill:!0,fillColor:"#FFCCCC",color:"#005FED",fillOpacity:.5,opacity:1,pane:"popUp",stroke:!0});var n=r-o;n>0?(e.options.fillOpacity=.5-.2*n,e.setStyle({fillOpacity:e.options.fillOpacity})):(e.options.fillOpacity=.5+.2*n,e.setStyle({fillOpacity:e.options.fillOpacity}),i.otherOptions.playbarOptions.playButtonEnabled&&l.impactMapService.resetPlayToStart(i))}}),e.on({click:function(e){var i=e.target;i.setStyle({weight:1,fill:!0,fillColor:"#FFCCCC",color:"#2CD9C5",fillOpacity:.5,opacity:1,pane:"popUp",stroke:!0});var o=l.gisPopupService.setHtmlContentForMiTanksStatePopup(e.target.feature.properties,t);s.responsivePopup({hasTip:!0,autoPan:!0,minWidth:300,maxWidth:500,closeButton:!0}).setLatLng(e.latlng).setContent(o).openOn(a),r.Browser.ie||r.Browser.edge||i.bringToFront(),a.fitBounds(i.getBounds()),t.locName=e.sourceTarget.feature.properties.tank_name,t.pUUID=e.sourceTarget.feature.properties.uuid,t.stationType=f.b.SOURCES.SENTINEL1,t.miTankId=e.sourceTarget.feature.properties.tank_geoid,t.capacity=e.sourceTarget.feature.properties.capacity,t.maxArea=e.sourceTarget.feature.properties.max_area,t.pType=f.b.LOCATIONS.MITANK,t.cType=f.b.LOCATIONS.MITANK,t.mandal_name=e.sourceTarget.feature.properties.mandal_nam,t.basin_name=e.sourceTarget.feature.properties.ba_name,t.district_name=e.sourceTarget.feature.properties.dist_name,t.subbasin_name=e.sourceTarget.feature.properties.sub_basin,t.state_name=e.sourceTarget.feature.properties.state_name,t.lng=e.sourceTarget.feature.properties.lng,t.lat=e.sourceTarget.feature.properties.lat,t.actionType="sensorClick",l.gisUtils.setSelectedParams(t)}}),[2,void 0]})})},e.ngInjectableDef=L.cb({factory:function(){return new e(L.gb(L.s),L.gb(h.a),L.gb(m.a),L.gb(c.a),L.gb(u.a),L.gb(A.c),L.gb(d.a),L.gb(v.a),L.gb(g.a))},token:e,providedIn:"root"}),e}()},T9b0:function(e,a,t){"use strict";t.d(a,"a",function(){return r});var r={COMPONENT:{MITANKS:"MITANK"},VIEWS:{ADMIN:"ADMIN",BASIN:"BASIN",PROJECT:"PROJECT"},API_MAPPING:{SOURCE:"comm/getrankwisesource1/",TABLE:"mi/aggregated ",BREADCRUMB:"locations/heirarchy",LOCATION_TYPES:"comm/getLocTypes",CHART:"mi/timeseries"},LOCATION_LEVEL:{STATION:"Station",GODAVARI:"Godavari",TELANGANA:"Telangana",TAMILNADU:"TAMILNADU",KALESHWARAM:"Kaleshwaram",BASIN:"BASIN",SUBBASIN:"SUBBASIN",RAINFALL:"RAINFALL",STATE:"STATE"},LOCATIONS:{TAMILNADU:{NAME:"TAMILNADU",ADMIN:{UUID:"e98cd5b7-6556-4c0f-a778-3429e1c14a6b",PTYPE:"STATE"},BASIN:{UUID:"e98cd5b7-6556-4c0f-a778-3429e1c14a6b",PTYPE:"STATE"}},TELANGANA:{NAME:"Telangana",ADMIN:{UUID:"927b67e9-a2aa-46e9-99bc-41cf8c502668",PTYPE:"STATE"},BASIN:{UUID:"927b67e9-a2aa-46e9-99bc-41cf8c502668",PTYPE:"STATE"},PROJECT:{UUID:"927b67e9-a2aa-46e9-99bc-41cf8c502668",PTYPE:"STATE"}},KALESHWARAM:{NAME:"Kaleshwaram",ADMIN:{UUID:"",PTYPE:"STATE"},BASIN:{UUID:"",PTYPE:"BASIN"}},GODAVARI:{NAME:"Godavari",ADMIN:{UUID:"",PTYPE:"BASIN"},BASIN:{UUID:"5ddb60ef-aede-46ab-b319-e8e9c36fd715",PTYPE:"BASIN"}}},TIME_STEP_MAPPING:{yyyy:"YEARLY",yyyyMMdd:"DAILY",yyyyMM:"MONTHLY",season:"SESONALLY"}}},TCHy:function(e,a,t){"use strict";t.d(a,"b",function(){return n}),t.d(a,"c",function(){return s}),t.d(a,"a",function(){return p});var r,i,o,l=t("7HLZ"),n={TILE_LAYER:"TILELAYER",WMS_LAYER:"WMS",VECTOR_LAYER:"VECTOR",GEOJSON_LAYER:"GEOJSON",HEATMAP_LAYER:"HEATMAP"},s={TELANGANA:"TELANGANA",INDIA:"INDIA",STATE:"STATE",COMMAND_AREA:"COMMAND_AREA",SUB_COMMAND_AREA:"SUB_COMMAND_AREA",DISTRICT:"COMMAND_DISTRICT",MANDAL:"COMMAND_MANDAL",ALL:"ALL",SRSP:"Sri Ram Sagar Project",VILLAGE:"VILLAGE",CANAL:"CANAL",RESERVOIR:"RESERVOIR",MITANK:"MITANK"},p={PANE_LIST:[{name:"tile",zindex:"390"},{name:"WA",zindex:"401"},{name:"state",zindex:"401"},{name:"district",zindex:"403"},{name:"basin",zindex:"404"},{name:"subbasin",zindex:"406"},{name:"circlemarkers",zindex:"601"},{name:"rivers",zindex:"608"},{name:"markers",zindex:"620"},{name:"popUp",zindex:"602"},{name:"heatMap",zindex:"400"}],LEGEND_DATA:{MI_Tanks:{title:"MI Tanks",levels:[{image:"../../../../../assets/imgs/visibilityDashboards/miTanks/MITankPolygon.png",color:"#ffffff"}]},DEPTH_CLASS_LEGEND2:{title:"Water Spread",levels:[{color:"#05C3DE",name:""}]},DEPTH_CLASS_LEGEND_WITH_CLOUD2:{title:"Water Spread",levels:[{color:"#05C3DE",name:""},{color:"#DCDCDC",name:"Cloud"}]},DEPTH_CLASS_LEGEND:{title:"Water Spread",levels:[{color:"#FFCCCC",name:"Empty"},{color:"#fae098",name:"Shallow"},{color:"#91cc9e",name:"Medium"},{color:"#15f4ee",name:"Deep"}]},DEPTH_CLASS_LEGEND_WITH_CLOUD:{title:"Water Spread",levels:[{color:"#FFCCCC",name:"Empty"},{color:"#fae098",name:"Shallow"},{color:"#91cc9e",name:"Medium"},{color:"#15f4ee",name:"Deep"},{color:"#DCDCDC",name:"Cloud"}]}},BASE_LAYER_LIST:(r={},r[n.TILE_LAYER]=[{name:"Open Street Map",displayName:"Open Street Map",layerServiceType:"TILELAYER",type:"Base",view:"Admin",default_select:!1,visible:!1,url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",maxNativeZoom:18,maxZoom:22,imagesrc:"../assets/imgs/maps/open-street.jpg"},{name:"Bhuvan",displayName:"Bhuvan",layerServiceType:"TILELAYER",type:"Base",view:"Admin",default_select:!1,visible:!1,url:"http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",maxNativeZoom:18,maxZoom:22,imagesrc:"../assets/imgs/maps/open-street.jpg"},{name:"Carto",displayName:"Carto",layerServiceType:"TILELAYER",type:"Base",view:"Admin",default_select:!1,visible:!1,url:"http://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png",maxNativeZoom:18,maxZoom:22,imagesrc:"../../assets/imgs/maps/base-map.jpg"},{name:"Google Satellite",displayName:"Google Satellite",layerServiceType:"TILELAYER",type:"Base",view:"Admin",default_select:!1,imagesrc:"../../assets/imgs/maps/satellite.jpg",visible:!0,url:"http://mt0.google.com/vt/lyrs=s&hl=en&x={x}&y={y}&z={z}",maxNativeZoom:18,maxZoom:22,subdomains:["mt0","mt1","mt2","mt3"]}],r),COMMON_LAYER_LIST:(i={},i[s.ALL]={Reservoir:{layerFrom:"GEOSERVER",name:"Reservoir",visible:!0,view:"ALL",parentView:[s.ALL],layerptions_show_on_selector:!1,layeroptions_name:"kaleshwaram:reservoirs_20210930_total_v1",layer_name:"reservoir_marker",layeroptions_pane:"district",layeroptions_min_zoom:5,layeroptions_max_zoom:22,group:"Layers",group_type:"radio-deselect",layerServiceType:n.GEOJSON_LAYER,onEachFeature:"handleReservoirPolygon",cql_filter:"",cql_filter_value:"location_1",type:n.GEOJSON_LAYER,style:"stylingforReservoir",hasLegend:!1,legendName:"RESERVOIR_POINTS"},"Command Area":{layerFrom:"GEOSERVER",name:"Command Area",visible:!0,view:"ALL",parentView:[s.ALL],layerptions_show_on_selector:!1,layeroptions_name:"kaleshwaram:project_wise_command_area",layer_name:"reservoir_marker",layeroptions_pane:"WA",layeroptions_min_zoom:5,layeroptions_max_zoom:22,group:"Layers",group_type:"radio-deselect",layerServiceType:n.GEOJSON_LAYER,cql_filter:"",cql_filter_value:"project_uuid",type:n.GEOJSON_LAYER,style:"stylingforGeoJson"},"MiTank Polygon":{sources:[l.b.SOURCES.SENTINEL1,l.b.SOURCES.SENTINEL1_DEM],layerFrom:"GEOSERVER",name:"MITANKS",visible:!0,view:"ALL",parentView:[s.ALL],layeroptions_name:"kaleshwaram:corewris_mitanks_polygon_1.0",layeroptions_min_zoom:5,layeroptions_max_zoom:22,hasLegend:!0,legendName:"MI_Tanks",layerptions_show_on_selector:!1,layer_name:"reservoir_marker",layeroptions_pane:"WA",group:"Layers",group_type:"radio-deselect",layerServiceType:n.GEOJSON_LAYER,cql_filter:"reservoir_cmd_uuid='7d95652e-ca75-11ea-87d0-0242ac130003'",cql_filter_value:"reservoir_cmd_uuid",type:n.GEOJSON_LAYER,style:"stylingforGeoJson",onEachFeature:"addMITanksPolygonLayerPd",paramType:"cType"}},i),DEPTH_LAYERS:(o={},o[l.b.SOURCES.SENTINEL_1]={"Telangana Depth Class":{layerFrom:"GEOSERVER",name:"Water Depth",visible:!0,view:"ADMIN",parentView:[s.ALL],layeroptions_name:"kaleshwaram:mitanks_depth_layer_view",layeroptions_min_zoom:5,layeroptions_max_zoom:22,hasLegend:!0,layerptions_show_on_selector:!1,layer_name:"Depth Class",layeroptions_pane:"WA",group:"Layers",group_type:"radio-deselect",layerServiceType:n.WMS_LAYER,type:n.WMS_LAYER,cType:s.MITANK,key:"Telangana Depth_Class",legendName:"DEPTH_CLASS_LEGEND2",source:"SENTINEL1",cql_filter:"source='SENTINEL_1'",displayName:"Water Depth",paramType:"cType",component:l.b.COMPONENT.MITANK}},o[l.b.SOURCES.SENTINEL1_DEM]={"Telangana Depth Class Sentinel1 DEM":{layerFrom:"GEOSERVER",name:"Water Depth",visible:!0,view:"ADMIN",parentView:[s.ALL],layeroptions_name:"kaleshwaram:mitanks_depth_layer_view",layeroptions_min_zoom:5,layeroptions_max_zoom:22,hasLegend:!0,layerptions_show_on_selector:!1,layer_name:"Depth Class",layeroptions_pane:"WA",group:"Layers",group_type:"radio-deselect",layerServiceType:n.WMS_LAYER,type:n.WMS_LAYER,cType:s.MITANK,key:"Telangana Depth_Class",legendName:"DEPTH_CLASS_LEGEND",source:"SENTINEL1_DEM",cql_filter:"source='SENTINEL1_DEM'",displayName:"WSA Layer",paramType:"cType",component:l.b.COMPONENT.MITANK}},o)}},abfC:function(e,a,t){"use strict";var r=t("MCLT"),i=t("6QN/"),o=t("q4vc"),l=t("Ip0R"),n=t("ElNF"),s=t("CcnG"),p=function(){function e(e){this.gisDataService=e,this.depthLayers=new Map,this.depthLayerOverlays=new Map,this.sourceWiseAvailableDates=new Map,this.removedLayersMap=new Map}return e.prototype.handleLayerControlEvent=function(e){var a=this;void 0===e&&(e="SENTINEL_1"),this.removedLayersMap.set(e,[]),null!=this.depthLayerOverlays.get(e)&&this.depthLayerOverlays.get(e).forEach(function(t,r){var i=t;"block"==i.getContainer().style.display&&a.removedLayersMap.get(e).push(i),i.getContainer().style.display="none"})},e.prototype.getPlayBarOptions=function(e){return{ceil:e.length,floor:1,showSelectionBar:!0,showTicks:!0,getLegend:function(a){return e[(a-1)%e.length].replace(/-/gi,"/")},ticksTooltip:function(a){return e[(a-1)%e.length]},translate:function(e,a){return""}}},e.prototype.loadDepthLayers=function(e,a,t,r,i,o,l,n,s){if(this.sourceWiseAvailableDates.set(a,t),this.map=e,this.removePreviousLayersFromMap(),"MITANK"==i)for(var p in this.depthLayers.set(a,new Map),this.depthLayerOverlays.set(a,new Map),t){var y=t[p],u=this.gisDataService.setWMSOverlays(e,this.gisDataService.getApplicationBasedLayer(r,"WMS",e)).Depth_Class,c=this.formatDate(y),m="";o&&(m=o+" AND "),u.wmsParams.cql_filter=m+="date="+c,this.depthLayers.get(a).set(c,u);var h=this.depthLayers.get(a).get(c).addTo(e);h.getContainer().style.display="none",this.depthLayerOverlays.get(a).set(c,h)}else u=this.gisDataService.setWMSOverlays(e,this.gisDataService.getApplicationBasedLayer(r,"WMS",e)).Depth_Class,c=this.formatDate(t[0]),m="",o&&(m=o+" AND "),u.wmsParams.cql_filter=m+="date="+c,this.parentdepthLayer=u},e.prototype.formatDate=function(e){return e.split("-")[2]+e.split("-")[1]+e.split("-")[0]},e.prototype.showDepthClassLayer=function(e,a,t,r,i,o){if("MITANK"==o){if(0==this.removedLayersMap.size){var l=this.formatDate(e);r&&0!=r&&(this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r-1])).getContainer().style.display="none"),i.nextValue&&0!=i.nextValue&&(this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[i.nextValue-1])).getContainer().style.display="none"),this.depthLayerOverlays.get(a).get(l).getContainer().style.display="block",this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r-1])).getContainer().style.removeProperty("clip"),i.prevValue=i.value,i.currentLayer=this.depthLayerOverlays.get(a).get(l)}}else this.showParentDepthClassLayer(e,i)},e.prototype.showParentDepthClassLayer=function(e,a){this.map.hasLayer(this.parentdepthLayer)&&this.map.removeLayer(this.parentdepthLayer);var t=this.parentdepthLayer.wmsParams.cql_filter,r=this.formatDate(e);this.parentdepthLayer.wmsParams.cql_filter=t.split("date=")[0]+"date="+r,this.parentdepthLayer.addTo(this.map),a.currentLayer=this.parentdepthLayer},e.prototype.clip=function(e,a,t,r,i,o){var l=e.containerPointToLayerPoint([0,0]),n=e.containerPointToLayerPoint(e.getSize()),s=l.x+(n.x-l.x)*t;(i<r&&i<=this.sourceWiseAvailableDates.get(a).length||i==this.sourceWiseAvailableDates.get(a).length&&1==r)&&"block"==this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[i-1])).getContainer().style.display&&(this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[i-1])).getContainer().style.display="none",this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[i-1])).getContainer().style.removeProperty("clip")),this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r-1])).getContainer().style.clip="rect("+[l.y,n.x,n.y,s].join("px,")+"px)",this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r%this.sourceWiseAvailableDates.get(a).length])).getContainer().style.clip="rect("+[l.y,s,n.y,l.x].join("px,")+"px)";var p=this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r%this.sourceWiseAvailableDates.get(a).length])).getContainer();"none"==this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r%this.sourceWiseAvailableDates.get(a).length])).getContainer().style.display&&t>=.01&&(p.style.opacity=0,this.depthLayerOverlays.get(a).get(this.formatDate(this.sourceWiseAvailableDates.get(a)[r%this.sourceWiseAvailableDates.get(a).length])).getContainer().style.display="block",setTimeout(function(){p.style.opacity=1},100)),o.currentLayer=this.depthLayerOverlays.get(this.sourceWiseAvailableDates.get(a)[r%this.sourceWiseAvailableDates.get(a).length]),o.prevValue=o.value,o.nextValue=(r+1)%this.sourceWiseAvailableDates.get(a).length},e.prototype.onUserChange=function(e,a,t,r,i){this.onPause(r),this.showDepthClassLayer(this.sourceWiseAvailableDates.get(a)[e-1],a,e,t,r,i)},e.prototype.animationValueChange=function(e,a,t,r,i){this.clip(this.map,a,e,t,r,i)},e.prototype.onPlay=function(e,a,t){var r=this;this.map=e,a.interval=setInterval(function(){a.prevValue=a.value,a.value=a.value%r.sourceWiseAvailableDates.get(t).length+1},3e3),a.animateInterval=setInterval(function(){a.rangeValue+=.025,r.clip(r.map,t,a.rangeValue,a.value,a.prevValue,a),a.rangeValue>=1&&(a.rangeValue=0)},80)},e.prototype.onPause=function(e){clearInterval(e.interval),clearInterval(e.animateInterval)},e.prototype.removePreviousLayersFromMap=function(){for(var e=0,a=Array.from(this.depthLayers.entries());e<a.length;e++)for(var t=a[e],r=0,i=Array.from(this.depthLayers.get(t[0]).entries());r<i.length;r++){var o=i[r];this.map.removeLayer(this.depthLayers.get(t[0]).get(o[0]))}this.removedLayersMap=new Map,this.parentdepthLayer&&this.map.hasLayer(this.parentdepthLayer)&&this.map.removeLayer(this.parentdepthLayer)},e.prototype.hideAllLayers=function(e){var a=this,t=1;this.depthLayerOverlays.get(e).forEach(function(r,i){var o=r;0!=a.removedLayersMap.size&&1==t&&(a.removedLayersMap.set(e,[]),a.removedLayersMap.get(e).push(r),t++),o.getContainer().style.display="none",o.getContainer().style.removeProperty("clip")})},e.ngInjectableDef=s.cb({factory:function(){return new e(s.gb(n.a))},token:e,providedIn:"root"}),e}(),y=t("7Bd3"),u=t("7HLZ"),c=t("T9b0"),m=t("b67C"),h=t("TCHy");t.d(a,"a",function(){return f});var d=function(e,a,t,r){return new(t||(t=Promise))(function(i,o){function l(e){try{s(r.next(e))}catch(a){o(a)}}function n(e){try{s(r.throw(e))}catch(a){o(a)}}function s(e){e.done?i(e.value):new t(function(a){a(e.value)}).then(l,n)}s((r=r.apply(e,a||[])).next())})},v=function(e,a){var t,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function n(o){return function(n){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=(i=l.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=a.call(e,l)}catch(n){o=[6,n],r=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,n])}}},f=function(){function e(e,a,t,r,i){this.utilsService=e,this.gisUtilsService=a,this.visibilityUtils=t,this.miTanksDataService=r,this.commonPdService=i,this.datePipe=new l.e("en-US"),this.availableDatesForDepthClass=[]}return e.prototype.getPlaybarOptions=function(){var e,a=((e={labels:[],interval:null,value:null,isPlay:!1,showPlayBar:!1,valueChanged:"valueChanged",onUserChangeStart:"onUserChangeStart",onUserChange:"onUserChange",onPlay:"onPlay",onPause:"onPause",animationValueChange:"animationValueChange",prevValue:null,nextValue:null,animateInterval:null,rangeValue:null,currentLayer:null,playButtonEnabled:!1})[u.b.VIEWS.ADMIN]=u.a[u.b.LOCATIONS.MITANK].MIN,e.options={},e);return a.prevValue=0,a.value=1,a.nextValue=0,a.rangeValue=0,a},e.prototype.resetPlaybarVaribales=function(e){clearInterval(e.otherOptions.playbarOptions.interval),clearInterval(e.otherOptions.playbarOptions.animateInterval),e.otherOptions.playbarOptions=this.getPlaybarOptions(),e.otherOptions.playbarOptions.value=this.availableDatesForDepthClass.length},e.prototype.setStationHighlightLayerPd=function(e){this.getSrcWiseLayersPd(e),e.removeComponentWiseLayers()},e.prototype.getSrcWiseLayersPd=function(e){return d(this,void 0,void 0,function(){return v(this,function(a){return e.iaSpnr=!0,e.sidebarParams.component==u.b.COMPONENT.MITANK&&(this.resetPlaybarVaribales(e),e.iaSpnr=!1,this.checkAndDepthClassLayers(e)),[2]})})},e.prototype.removeDepthClassLayer=function(e){this.removeLayers(e,["Telangana Depth Class","Telangana Depth Class Sentinel1 DEM"])},e.prototype.removeLayers=function(e,a){for(var t=0,r=a;t<r.length;t++){var i=r[t];e.map.hasLayer(e.layers.overlaylayers[i])&&e.map.removeLayer(e.layers.overlaylayers[i]),delete e.layers.overlaylayers[i]}},e.prototype.checkAndDepthClassLayers=function(e){return d(this,void 0,void 0,function(){var a,t,r;return v(this,function(i){switch(i.label){case 0:return a=e.sidebarParams,e.iaSpnr=!0,this.availableDatesForDepthClass=[],a.cType!=u.b.LOCATIONS.MITANK?[3,2]:(t=this,[4,this.getDepthClassDateRange(e)]);case 1:t.availableDatesForDepthClass=i.sent(),this.availableDatesForDepthClass.length>0&&(this.latestDepthClassDate=(r=this.availableDatesForDepthClass[0]).split("-")[2]+r.split("-")[1]+r.split("-")[0],e.otherOptions.playbarOptions.labels=this.availableDatesForDepthClass),i.label=2;case 2:return this.showPlayProgressBar(e),e.iaSpnr=!1,[2]}})})},e.prototype.showPlayProgressBar=function(e){this.loadDepthLayers(e);var a=this.commonPdService.getPlayBarOptions(this.availableDatesForDepthClass);e.otherOptions.playbarOptions.options=a,e.otherOptions.playbarOptions.showPlayBar=!0,e.otherOptions.playbarOptions.playButtonEnabled=e.sidebarParams.pType==u.b.LOCATIONS.MITANK},e.prototype.addDepthLayerToOverlayLayers=function(e){var a=this.getDepthClassLayerBasedOnParams(e.sidebarParams);null!=a&&null!=e.otherOptions.playbarOptions.currentLayer&&(e.layers.overlaylayers[a]=e.otherOptions.playbarOptions.currentLayer)},e.prototype.getDepthClassLayerBasedOnParams=function(e){var a=null;return e.view==u.b.VIEWS.ADMIN&&(a="SENTINEL_1"==e.source?"Telangana Depth Class":"Telangana Depth Class Sentinel1 DEM"),a},e.prototype.showDepthClassLayer=function(e,a){var t=a.split("-")[2]+a.split("-")[1]+a.split("-")[0],r=this.getDepthClassLayerBasedOnParams(e.sidebarParams);null!=r&&(e.map.hasLayer(e.layers.overlaylayers[r])&&e.map.removeLayer(e.layers.overlaylayers[r]),e.layers.overlaylayers[r].wmsParams.cql_filter="date="+t,e.map.addLayer(e.layers.overlaylayers[r]))},e.prototype.valueChanged=function(e,a){e.otherOptions.playbarOptions.rangeValue=0},e.prototype.onUserChangeStart=function(e,a){this.onPause(e)},e.prototype.onUserChange=function(e,a){this.commonPdService.onUserChange(e.otherOptions.playbarOptions.value,e.sidebarParams.source,e.otherOptions.playbarOptions.prevValue,e.otherOptions.playbarOptions,e.sidebarParams.pType),this.addDepthLayerToOverlayLayers(e)},e.prototype.onPlay=function(e){e.otherOptions.playbarOptions.isPlay=!0,this.commonPdService.onPlay(e.map,e.otherOptions.playbarOptions,e.sidebarParams.source)},e.prototype.onPause=function(e){e.otherOptions.playbarOptions.isPlay=!1,this.commonPdService.onPause(e.otherOptions.playbarOptions)},e.prototype.animationValueChange=function(e,a){this.commonPdService.animationValueChange(e.otherOptions.playbarOptions.rangeValue,e.sidebarParams.source,e.otherOptions.playbarOptions.value,e.otherOptions.playbarOptions.prevValue,e.otherOptions.playbarOptions)},e.prototype.getDepthClassDateRange=function(e){var a=this,t={},r=this.getPostDataForDepthClass(e);return new Promise(function(e,i){a.miTanksDataService.post(c.a.API_MAPPING.CHART,r).subscribe(function(r){a.utilsService.isEmptyObj(r)||(t=a.preProcessDepthClassDates(r)),e(t)})})},e.prototype.preProcessDepthClassDates=function(e){for(var a=[],t=0,r=Object.keys(e);t<r.length;t++)a.push(this.datePipe.transform(r[t],"dd-MM-yyyy"));return a},e.prototype.resetPlayToStart=function(e){this.onPause(e),e.otherOptions.playbarOptions.prevValue=0,e.otherOptions.playbarOptions.value=this.availableDatesForDepthClass.length,e.otherOptions.playbarOptions.nextValue=0,e.otherOptions.playbarOptions.rangeValue=0,this.commonPdService.hideAllLayers(e.sidebarParams.source),this.commonPdService.showDepthClassLayer(this.availableDatesForDepthClass[this.availableDatesForDepthClass.length-1],e.sidebarParams.source,e.otherOptions.playbarOptions.prevValue,e.otherOptions.playbarOptions.value,e.otherOptions.playbarOptions,e.sidebarParams.pType)},e.prototype.getPostDataForDepthClass=function(e){var a=e.sidebarParams;return{eDate:a.eDate,sDate:a.sDate,pEUUID:"927b67e9-a2aa-46e9-99bc-41cf8c502668",pType:"COMMAND_AREA",format:"DAILY",cType:a.cType,pUUID:e.commandUUID,src:a.sourceData.value,aggr:"LATEST",optionalPeriodList:[]}},e.prototype.loadDepthLayers=function(e){return d(this,void 0,void 0,function(){var a,t,r,i;return v(this,function(o){switch(o.label){case 0:return a=e.sidebarParams,e.iaSpnr=!0,t={},null==(r=this.getDepthClassLayerBasedOnParams(e.sidebarParams))?[3,3]:(t.Depth_Class=h.a.DEPTH_LAYERS[e.sidebarParams.source][r],i=h.a.DEPTH_LAYERS[e.sidebarParams.source][r].cql_filter,i+=" AND reservoir_cmd_uuid='"+e.commandUUID+"'",e.otherOptions.playbarOptions.value=this.availableDatesForDepthClass.length,[4,this.commonPdService.loadDepthLayers(e.map,e.sidebarParams.source,this.availableDatesForDepthClass,t,a.pType,i)]);case 1:return o.sent(),[4,this.commonPdService.showDepthClassLayer(this.availableDatesForDepthClass[this.availableDatesForDepthClass.length-1],e.sidebarParams.source,e.otherOptions.playbarOptions.prevValue,e.otherOptions.playbarOptions.value,e.otherOptions.playbarOptions,a.pType)];case 2:o.sent(),this.addDepthLayerToOverlayLayers(e),o.label=3;case 3:return e.iaSpnr=!1,[2]}})})},e.prototype.handleLayerControlEvent=function(e,a){this.commonPdService.handleLayerControlEvent(e.sidebarParams.source)},e.prototype.highlightGeojsonLayer=function(e){if(e.sidebarParams.pType==u.b.LOCATIONS.MITANK){var a="";e.sidebarParams.view==u.b.VIEWS.ADMIN&&(a="MiTank Polygon"),this.setPolygonLayerHighlight(e.layers.overlaylayers[a],e),this.availableDatesForDepthClass.length>0&&(this.resetPlaybarVaribales(e),this.showPlayProgressBar(e))}},e.prototype.setPolygonLayerHighlight=function(e,a){var t=a.params,i=[];t.latlng&&!Object(r.isNullOrUndefined)(t.latlng.split(","))&&t.latlng.split(",").length>1&&(i.push(t.latlng.split(",")[0]),i.push(t.latlng.split(",")[1]),a.map.setView(i,16))},e.ngInjectableDef=s.cb({factory:function(){return new e(s.gb(o.a),s.gb(i.a),s.gb(m.a),s.gb(y.a),s.gb(p))},token:e,providedIn:"root"}),e}()}}]);